#!/bin/bash

GLOBAL=$(git config --global user.email)
EMAIL=$(git config user.email)
KEY="iam.$1"

if [[ -n "$2" ]]; then
    echo "git config --add $KEY $2"
elif [[ -n "$1" ]]; then
    EMAIL="$(git config --get $KEY)"
    if [[ "$GLOBAL" = "$EMAIL" ]]; then
        git config --local --unset user.email
    else
        git config --local user.email $EMAIL
    fi
fi

ALIAS=$(git config --get-regexp iam | grep "$EMAIL" | cut -d " " -f 1 | sed -e 's/^iam\.//')

echo "This repository is now using: $EMAIL ($ALIAS)"
